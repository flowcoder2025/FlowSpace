# ë³€ê²½ ë¡œê·¸ - 2026-01-22

> ì–´ë“œë¯¼ ëŒ€ì‹œë³´ë“œ íŠ¸ëž˜í”½/ìƒê´€ê³„ìˆ˜ ê³„ì‚° ì˜¤ë¥˜ ìˆ˜ì •

---

## ìš”ì•½

| í•­ëª© | ë‚´ìš© |
|------|------|
| ë‚ ì§œ | 2026-01-22 |
| ì»¤ë°‹ | `e5a43dc`, `b506af6` |
| ì˜í–¥ ë²”ìœ„ | ì–´ë“œë¯¼ ëŒ€ì‹œë³´ë“œ (`/admin`) |
| ì‹¬ê°ë„ | ðŸ”´ Critical (ë°ì´í„° í‘œì‹œ ì˜¤ë¥˜) |

---

## ë°œê²¬ëœ ë¬¸ì œ

### 1. íŠ¸ëž˜í”½ ë¸íƒ€ ê³„ì‚° ì˜¤ë¥˜

**ìœ„ì¹˜**: `src/app/api/cron/collect-metrics/route.ts`

**í˜„ìƒ**: OCI 23GB vs ëŒ€ì‹œë³´ë“œ 7,634GB (319ë°° ì°¨ì´)

**ì›ì¸**: 5ë¶„ë§ˆë‹¤ ìˆ˜ì§‘ë˜ëŠ” Cronì´ ì‹¤ì œ ê²½ê³¼ ì‹œê°„ì„ ê³ ë ¤í•˜ì§€ ì•Šê³  ëˆ„ì ê°’ ì°¨ì´ë¥¼ ê·¸ëŒ€ë¡œ ë¸íƒ€ë¡œ ì €ìž¥

**ìˆ˜ì •**:
```typescript
// ì´ì „
const rawDelta = (trafficGB - lastSnapshot.trafficGB) * 1024
trafficDeltaMB = rawDelta

// ìˆ˜ì • í›„ - ì‹œê°„ ê¸°ë°˜ ì •ê·œí™”
const elapsedMinutes = (Date.now() - lastSnapshot.timestamp.getTime()) / 60000
const normalizedDelta = rawDelta * (5 / elapsedMinutes)  // 5ë¶„ ê¸°ì¤€ ì •ê·œí™”
```

---

### 2. ìƒê´€ê³„ìˆ˜ ê³„ì‚° ì˜¤ë¥˜

**ìœ„ì¹˜**: `src/app/api/admin/usage/analysis/route.ts`

**í˜„ìƒ**: GB/ì‚¬ìš©ìž-ì‹œê°„ = 401.813 (ì •ìƒ: 0.1~2.0)

**ì›ì¸**: period(hourly/daily/weekly)ì— ê´€ê³„ì—†ì´ ë™ì¼í•œ ì‹œê°„ ë‹¨ìœ„ ì‚¬ìš©

**ìˆ˜ì •**:
```typescript
// ì´ì „
const totalUserHours = records.reduce((sum, r) => sum + r.concurrentUsers, 0)

// ìˆ˜ì • í›„ - periodë³„ ì‹œê°„ ë‹¨ìœ„ ì ìš©
const hoursPerRecord =
  period === "hourly" ? 1 :
  period === "daily" ? 8 :    // ì¼ì¼ ìš´ì˜ì‹œê°„ 8ì‹œê°„ ê°€ì •
  period === "weekly" ? 56 : 1

const totalUserHours = records.reduce(
  (sum, r) => sum + r.concurrentUsers * hoursPerRecord, 0
)
```

---

### 3. íŠ¸ëž˜í”½ í¼ì„¼íŠ¸ í‘œì‹œ ì˜¤ë¥˜

**ìœ„ì¹˜**: `src/lib/utils/oci-cost.ts`

**í˜„ìƒ**: 23.91GB / 10,240GB = 0% (ì •ìƒ: 0.2%)

**ì›ì¸**: `Math.round()`ë¡œ ì¸í•´ 0.23%ê°€ 0%ë¡œ ë°˜ì˜¬ë¦¼

**ìˆ˜ì •**:
```typescript
// ì´ì „
return Math.round((used / limit) * 100)

// ìˆ˜ì • í›„ - ì†Œìˆ˜ì  1ìžë¦¬
return Math.round((used / limit) * 1000) / 10
```

---

### 4. OCI ì„œë²„ ì—°ê²° ì˜¤ë¥˜

**í˜„ìƒ**: Socket.io/LiveKit ìƒíƒœ "ì•Œ ìˆ˜ ì—†ìŒ"

**ì›ì¸**: ì´ì „ ì„¸ì…˜ì—ì„œ ë³´ì•ˆ ê°•í™”ë¡œ `OCI_INTERNAL_IP` í•˜ë“œì½”ë”© ì œê±° í›„ Vercel í™˜ê²½ ë³€ìˆ˜ ë¯¸ì„¤ì •

**ìˆ˜ì •**: Vercel í™˜ê²½ ë³€ìˆ˜ì— `OCI_INTERNAL_IP=144.24.72.143` ì¶”ê°€

---

## ìˆ˜ì •ëœ íŒŒì¼

| íŒŒì¼ | ë³€ê²½ ë‚´ìš© |
|------|----------|
| `src/app/api/cron/collect-metrics/route.ts` | íŠ¸ëž˜í”½ ë¸íƒ€ ì‹œê°„ ê¸°ë°˜ ì •ê·œí™” |
| `src/app/api/admin/usage/analysis/route.ts` | ìƒê´€ê³„ìˆ˜ ê³„ì‚° periodë³„ hoursPerRecord |
| `src/app/admin/components/UsageAnalysis.tsx` | ë¹„ì •ìƒ ê°’ ê²½ê³  UI ì¶”ê°€ |
| `src/lib/utils/oci-cost.ts` | í¼ì„¼íŠ¸ ì†Œìˆ˜ì  1ìžë¦¬ í‘œì‹œ |
| `claude.md` | í•œê¸€ ì‘ë‹µ ê·œì¹™ ì¶”ê°€ |

---

## ì˜ˆìƒ ê²°ê³¼

| ì§€í‘œ | ìˆ˜ì • ì „ | ìˆ˜ì • í›„ |
|------|:------:|:------:|
| íŠ¸ëž˜í”½ (7ì¼) | 7,634 GB | ~30-50 GB |
| GB/ì‚¬ìš©ìž-ì‹œê°„ | 401.813 | 0.5~3.0 |
| ë¹„ìš© ì˜ˆì¸¡ (50ëª…Ã—5ì‹œê°„Ã—22ì¼) | $18,697 | $0 |
| íŠ¸ëž˜í”½ í¼ì„¼íŠ¸ | 0% | 0.2% |
| Socket.io/LiveKit ìƒíƒœ | ì•Œ ìˆ˜ ì—†ìŒ | ì‹¤í–‰ ì¤‘ |

---

## ê²€ì¦ ë°©ë²•

1. **ì–´ë“œë¯¼ ëŒ€ì‹œë³´ë“œ** (`/admin`) ì ‘ì†
2. **OCI ì¸í”„ë¼ íƒ­** í™•ì¸
   - Socket.io / LiveKit: ðŸŸ¢ ì‹¤í–‰ ì¤‘
   - íŠ¸ëž˜í”½: 23.91 GB / 10,240 GB (**0.2%**)
3. **ì‚¬ìš©ëŸ‰ ë¶„ì„ íƒ­** í™•ì¸ (7ì¼ í›„)
   - GB/ì‚¬ìš©ìž-ì‹œê°„: 0.1~2.0 ë²”ìœ„
   - ë¹„ìš© ì˜ˆì¸¡: $0 (10TB ë¬´ë£Œ ë²”ìœ„)

---

## SSH ì„œë²„ ë°ì´í„° ëŒ€ì¡° (2026-01-22 02:41 UTC)

| í•­ëª© | ì„œë²„ (SSH) | ëŒ€ì‹œë³´ë“œ | ì¼ì¹˜ |
|------|-----------|---------|:----:|
| ë©”ëª¨ë¦¬ | 560 MB / 23 GB | 0.86 GB / 24 GB | âš ï¸ ì¸¡ì • ë°©ì‹ ì°¨ì´ |
| ë””ìŠ¤í¬ | 5.4 GB / 45 GB (12%) | 5.33 GB / 47 GB (12%) | âœ… |
| íŠ¸ëž˜í”½ (TX) | 22.26 GB (vnstat) | 23.91 GB (OCI API) | âœ… |
| CPU Load | 0.00 | 0.48% | âœ… |

---

## ê´€ë ¨ ì»¤ë°‹

```
e5a43dc fix: íŠ¸ëž˜í”½ í¼ì„¼íŠ¸ ì†Œìˆ˜ì  í‘œì‹œ ìˆ˜ì •
b506af6 fix: ì–´ë“œë¯¼ ëŒ€ì‹œë³´ë“œ íŠ¸ëž˜í”½/ìƒê´€ê³„ìˆ˜ ê³„ì‚° ì˜¤ë¥˜ ìˆ˜ì •
5c365fe refactor: ë³´ì•ˆ ê°•í™” ë° API ì½”ë“œ ì¤‘ë³µ ì œê±° (ì´ì „ ì„¸ì…˜)
```

---

## í›„ì† ì¡°ì¹˜

- [x] íŠ¸ëž˜í”½ ë¸íƒ€ ê³„ì‚° ìˆ˜ì •
- [x] ìƒê´€ê³„ìˆ˜ ê³„ì‚° ìˆ˜ì •
- [x] í¼ì„¼íŠ¸ ì†Œìˆ˜ì  í‘œì‹œ ìˆ˜ì •
- [x] Vercel í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (`OCI_INTERNAL_IP`)
- [ ] 7ì¼ í›„ ìƒê´€ê³„ìˆ˜ ë¶„ì„ ê²°ê³¼ í™•ì¸
- [ ] ë°ì´í„° ìˆ˜ì§‘ ì •ìƒ ì—¬ë¶€ ëª¨ë‹ˆí„°ë§

---

> ìž‘ì„±: Claude Opus 4.5 | 2026-01-22
