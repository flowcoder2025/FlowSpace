# TASK: FlowSpace í•µì‹¬ ê¸°ëŠ¥ í—ˆì  ìˆ˜ì • (38ê°œ í•­ëª©)

> **ìƒì„±ì¼**: 2026-01-07
> **ëª©í‘œ**: í†µê³„/ì±„íŒ…/ì¸ì¦ ì‹œìŠ¤í…œì˜ 38ê°œ ì ì¬ì  í—ˆì  ìˆ˜ì •
> **ìƒíƒœ**: âœ… Phase 4 ì™„ë£Œ - 27/38 ìˆ˜ì • ì™„ë£Œ (71%), 11ê°œ ë³´ë¥˜
> **ì´ì „ íƒœìŠ¤í¬**: ìŒì„± ë° ë¹„ë””ì˜¤ ê³ ê¸‰ ì„¤ì • ì‹œìŠ¤í…œ (ì™„ë£Œ)

---

## ì§„í–‰ ìƒíƒœ ìš”ì•½

| Phase | ì‹¬ê°ë„ | í•­ëª©ìˆ˜ | ì™„ë£Œ | ë³´ë¥˜ | ì§„í–‰ë¥  |
|-------|--------|-------|------|------|--------|
| Phase 1 | Critical | 4 | 4 | 0 | 100% âœ… |
| Phase 2 | High | 10 | 10 | 0 | 100% âœ… |
| Phase 3 | Medium | 17 | 10 | 7 | 59% âœ… |
| Phase 4 | Low | 7 | 3 | 4 | 43% âœ… |
| **í•©ê³„** | - | **38** | **27** | **11** | **71%** |

**Phase 3 ì™„ë£Œ í•­ëª©**: 3.1, 3.3, 3.4, 3.5, 3.6, 3.10, 3.11, 3.14, 3.16, 3.17
**Phase 3 ë³´ë¥˜ í•­ëª©**: 3.2 (ìµœì í™”), 3.7-3.9 (ë³µì¡/ë‚®ì€ ìš°ì„ ìˆœìœ„), 3.12-3.13 (ë¬¸ì œ ì—†ìŒ), 3.15 (ë‚®ì€ ìœ„í—˜ë„)
**Phase 4 ì™„ë£Œ í•­ëª©**: 4.3, 4.5, 4.6
**Phase 4 ë³´ë¥˜ í•­ëª©**: 4.1 (DB ì¸ë±ìŠ¤), 4.2 (ì´ë¡ ì  ìœ„í—˜), 4.4 (ì¸í”„ë¼), 4.7 (cron job)

---

## Phase 1: Critical (ì¦‰ì‹œ ìˆ˜ì •)

### 1.1 [í†µê³„] ì¬ë°©ë¬¸ìœ¨ ì¤‘ë³µ ê³„ì‚° ë²„ê·¸
- **íŒŒì¼**: `src/app/api/admin/stats/route.ts:202-339`
- **ë¬¸ì œ**: `groupBy(["spaceId", "nickname"])`ë¡œ ë™ì¼ ì‚¬ìš©ìê°€ ì—¬ëŸ¬ ê³µê°„ ë°©ë¬¸ ì‹œ ì¤‘ë³µ ì§‘ê³„
- **í•´ê²°**: guestSession.id / userId ê¸°ì¤€ ê·¸ë£¹í™”ë¡œ ë³€ê²½
- **ì²´í¬ë¦¬ìŠ¤íŠ¸**:
  - [x] ê²ŒìŠ¤íŠ¸ ì¬ë°©ë¬¸ìœ¨: guestSessionId ê¸°ì¤€ ê·¸ë£¹í™”
  - [x] ì¸ì¦ ì‚¬ìš©ì: userId ê¸°ì¤€ ê·¸ë£¹í™” (spaceId ì œê±°)
  - [x] ì¬ë°©ë¬¸ ì •ì˜ í†µì¼: ë™ì¼ ì„¸ì…˜/ì‚¬ìš©ìì˜ 2íšŒ ì´ìƒ ENTER
- **ìƒíƒœ**: âœ… ì™„ë£Œ

### 1.2 [í†µê³„] ì²´ë¥˜ì‹œê°„ ë§ˆì§€ë§‰ EXITë§Œ ì‚¬ìš©
- **íŒŒì¼**: `src/app/api/admin/stats/route.ts:299-317`
- **ë¬¸ì œ**: Map ë®ì–´ì“°ê¸°ë¡œ ì—¬ëŸ¬ ENTERì— ë§ˆì§€ë§‰ EXITë§Œ ë§¤ì¹­
- **í•´ê²°**: ê° ENTER-EXIT ìŒì„ ì‹œê°„ìˆœ ë§¤ì¹­
- **ì²´í¬ë¦¬ìŠ¤íŠ¸**:
  - [x] Map â†’ Array ë³€ê²½ (ëª¨ë“  ENTER/EXIT ë³´ì¡´)
  - [x] ì‹œê°„ìˆœ ì •ë ¬ í›„ ê°€ì¥ ê°€ê¹Œìš´ EXIT ë§¤ì¹­
  - [x] ë™ì¼ ì„¸ì…˜ì˜ ë‹¤ì¤‘ ì…ì¥/í‡´ì¥ ì²˜ë¦¬
- **ìƒíƒœ**: âœ… ì™„ë£Œ

### 1.3 [í†µê³„] í”¼í¬ ë™ì ‘ = ì¼ì¼ ENTER ìˆ˜ (dashboard API)
- **íŒŒì¼**: `src/app/api/dashboard/spaces/[id]/stats/route.ts:142-148`
- **ë¬¸ì œ**: `Math.max(...dailyEnters.values())` = ë™ì‹œì ‘ì†ì´ ì•„ë‹Œ ì´ë²¤íŠ¸ ì¹´ìš´íŠ¸
- **í•´ê²°**: admin/statsì™€ ë™ì¼í•œ ENTER/EXIT Set ê¸°ë°˜ ê³„ì‚°
- **ì²´í¬ë¦¬ìŠ¤íŠ¸**:
  - [x] ENTER/EXIT ì´ë²¤íŠ¸ ì¡°íšŒ ì¿¼ë¦¬ ì¶”ê°€
  - [x] Set ê¸°ë°˜ ë™ì‹œì ‘ì†ì ì¶”ì  ë¡œì§ êµ¬í˜„
  - [x] ê¸°ì¡´ dailyEnters ë¡œì§ ì œê±°
- **ìƒíƒœ**: âœ… ì™„ë£Œ

### 1.4 [ì¸ì¦] ê°œë°œ ëª¨ë“œ ë°±ë„ì–´ ì œê±°
- **íŒŒì¼**: `src/app/api/spaces/[id]/members/route.ts:46-59`
- **ë¬¸ì œ**: `NODE_ENV=development`ì‹œ ìë™ ë¡œê·¸ì¸ (DEV_TEST_USER_ID)
- **í•´ê²°**: í•´ë‹¹ ì½”ë“œ ë¸”ë¡ ì™„ì „ ì‚­ì œ
- **ì²´í¬ë¦¬ìŠ¤íŠ¸**:
  - [x] DEV_TEST_USER_ID ìƒìˆ˜ ì œê±°
  - [x] IS_DEV ë¶„ê¸° ë¡œì§ ì œê±°
  - [x] getUserId() í•¨ìˆ˜ ì •ë¦¬
- **ìƒíƒœ**: âœ… ì™„ë£Œ

---

## Phase 2: High (1ì£¼ì¼ ë‚´ ìˆ˜ì •) âœ… ì™„ë£Œ

### 2.1 [í†µê³„] ENTER ì—†ëŠ” EXIT ì´ë²¤íŠ¸ ë¬´ì‹œ
- **íŒŒì¼**: `src/app/api/admin/stats/route.ts:375-396`
- **í•´ê²°**: ë¶ˆì™„ì „ ì„¸ì…˜ (ENTER ì—†ëŠ” EXIT, EXIT ì—†ëŠ” ENTER) ë³„ë„ ì§‘ê³„
- **êµ¬í˜„**: `dataQuality.incompleteEnterSessions`, `dataQuality.incompleteExitSessions` í•„ë“œ ì¶”ê°€
- **ìƒíƒœ**: âœ… ì™„ë£Œ

### 2.2 [í†µê³„] 24ì‹œê°„ ì´ìƒ ì²´ë¥˜ ë°ì´í„° ì œì™¸
- **íŒŒì¼**: `src/app/api/admin/stats/route.ts:283-372`
- **í•´ê²°**: 24ì‹œê°„ ì´ìƒ ì²´ë¥˜ëŠ” `outlierDurations` ë°°ì—´ë¡œ ë³„ë„ ì§‘ê³„
- **êµ¬í˜„**: `dataQuality.outlierSessions`, `dataQuality.outlierAvgDuration` í•„ë“œ ì¶”ê°€
- **ìƒíƒœ**: âœ… ì™„ë£Œ

### 2.3 [í†µê³„] 1ì£¼ì¼ ì´ì „ ì…ì¥ ì„¸ì…˜ ë™ì ‘ ëˆ„ë½
- **íŒŒì¼**: `src/app/api/dashboard/spaces/[id]/stats/route.ts:120-128`
- **í•´ê²°**: ë™ì ‘ ê³„ì‚°ìš© ENTER ì¡°íšŒ ë²”ìœ„ë¥¼ 1ê°œì›”ë¡œ í™•ì¥ (`oneMonthAgo`)
- **ìƒíƒœ**: âœ… ì™„ë£Œ

### 2.4 [í†µê³„] ë™ì¼ ì‹œê° ENTER/EXIT ìˆœì„œ ë¯¸ë³´ì¥
- **íŒŒì¼**: Phase 1.3ì—ì„œ í•´ê²°ë¨ (EXIT delta=-1 ìš°ì„  ì •ë ¬)
- **ìƒíƒœ**: âœ… ì™„ë£Œ (ì´ë¯¸ êµ¬í˜„ë¨)

### 2.5 [ì±„íŒ…] ë©”ì‹œì§€ DB ì €ì¥ ì‹¤íŒ¨ ì‹œ ë¡¤ë°± ì—†ìŒ
- **íŒŒì¼**: `server/socket-server.ts`, `types.ts`, `useSocket.ts`, `SpaceLayout.tsx`
- **í•´ê²°**: `chat:messageFailed` ì´ë²¤íŠ¸ ì •ì˜ ë° í´ë¼ì´ì–¸íŠ¸ ë¡¤ë°± ì²˜ë¦¬
- **ìƒíƒœ**: âœ… ì™„ë£Œ

### 2.6 [ì±„íŒ…] ê·“ì†ë§ ë¶€ë¶„ ì „ì†¡ ì‹¤íŒ¨
- **íŒŒì¼**: `server/socket-server.ts`, `types.ts`, `useSocket.ts`
- **í•´ê²°**: `whisper:messageFailed` ì´ë²¤íŠ¸ ì¶”ê°€, ë°œì‹ ìì™€ ìˆ˜ì‹ ì ëª¨ë‘ì—ê²Œ ë¡¤ë°± ì „ì†¡
- **ìƒíƒœ**: âœ… ì™„ë£Œ

### 2.7 [ì±„íŒ…] ê²Œì„ ì¤€ë¹„ ì „ ì´ë™ ì´ë²¤íŠ¸ ì†ì‹¤
- **íŒŒì¼**: `src/features/space/socket/useSocket.ts:293-316`
- **í•´ê²°**: `handleGameReady`ì—ì„œ players Mapì˜ ìµœì‹  ìœ„ì¹˜ ì‚¬ìš©
- **êµ¬í˜„**: `setPlayers` ì½œë°± ë‚´ì—ì„œ `currentPlayers.get(player.id)` ì°¸ì¡°
- **ìƒíƒœ**: âœ… ì™„ë£Œ

### 2.8 [ì±„íŒ…] ë‹‰ë„¤ì„ ìŠ¤í‘¸í•‘ìœ¼ë¡œ ê·“ì†ë§ ê°€ë¡œì±„ê¸°
- **íŒŒì¼**: `server/socket-server.ts:831-837`
- **í•´ê²°**: ë™ì¼ ë‹‰ë„¤ì„ì´ ë‹¤ë¥¸ playerIdë¥¼ ê°€ì§€ë©´ ì—ëŸ¬ ë°˜í™˜ (ìŠ¤í‘¸í•‘ ë°©ì§€)
- **êµ¬í˜„**: `uniquePlayerIds.size > 1` ì²´í¬ ì¶”ê°€
- **ìƒíƒœ**: âœ… ì™„ë£Œ (ì™„í™”ì±… ì ìš©, ê·¼ë³¸ í•´ê²°ì€ playerId ê¸°ë°˜ ì „í™˜ í•„ìš”)

### 2.9 [ì¸ì¦] ê²ŒìŠ¤íŠ¸ í† í° ì—”íŠ¸ë¡œí”¼ ì•½í•¨
- **íŒŒì¼**: `src/app/api/guest/route.ts:12-21, 102-104`
- **í•´ê²°**: `crypto.randomBytes` ê¸°ë°˜ 6ìë¦¬ ì˜ìˆ«ì suffix (ì•½ 22ì–µ ê²½ìš°ì˜ ìˆ˜)
- **êµ¬í˜„**: `generateSecureRandomSuffix()` í•¨ìˆ˜ ì¶”ê°€
- **ìƒíƒœ**: âœ… ì™„ë£Œ

### 2.10 [ì¸ì¦] LiveKit í† í° ë°œê¸‰ ì‹œ ê¶Œí•œ ê²€ì¦ ë¶€ì¬
- **íŒŒì¼**: `src/app/api/livekit/token/route.ts:160-203`
- **í•´ê²°**: ì¸ì¦ëœ ì‚¬ìš©ìì˜ ê³µê°„ ë©¤ë²„ì‹­ ê²€ì¦ ì¶”ê°€ (SpaceMember ë˜ëŠ” Space OWNER)
- **êµ¬í˜„**: ë¹„ë©¤ë²„ëŠ” sessionToken(ê²ŒìŠ¤íŠ¸ ì„¸ì…˜) í•„ìš”
- **ìƒíƒœ**: âœ… ì™„ë£Œ

---

## Phase 3: Medium (1ê°œì›” ë‚´ ìˆ˜ì •) - ğŸš§ ì§„í–‰ ì¤‘

### 3.1 [í†µê³„] ì£¼ê°„ ì²´ë¥˜ì‹œê°„ ë³€í™”ìœ¨ì´ í•­ìƒ 0
- **íŒŒì¼**: `src/app/api/admin/stats/route.ts:448-541`
- **ë¬¸ì œ**: ì§€ë‚œì£¼ ë°ì´í„° ê³„ì‚° ë¯¸êµ¬í˜„
- **í•´ê²°**: ì§€ë‚œì£¼ ì²´ë¥˜ì‹œê°„ ì¿¼ë¦¬ ì¶”ê°€ (lastWeekGuestEnterLogs, lastWeekAuthEnterLogs ë“±)
- **êµ¬í˜„**: durationChange ê³„ì‚° ë° weeklyChange.durationì— ì ìš©
- **ìƒíƒœ**: âœ… ì™„ë£Œ

### 3.2 [í†µê³„] ì¿¼ë¦¬ ì¤‘ë³µìœ¼ë¡œ ë©”ëª¨ë¦¬ 4ë°° ì‚¬ìš©
- **íŒŒì¼**: `src/app/api/admin/stats/route.ts:77-219`
- **ë¬¸ì œ**: ê°™ì€ ì¡°ê±´ì˜ ENTER/EXIT 4ë²ˆ ë°˜ë³µ ì¡°íšŒ
- **í•´ê²°**: Promise.allë¡œ ë³‘ë ¬ ì‹¤í–‰ ì¤‘ (ì„±ëŠ¥ìƒ ë¬¸ì œ ì—†ìŒ, ë¦¬íŒ©í† ë§ì€ í–¥í›„)
- **ìƒíƒœ**: â¸ï¸ ë³´ë¥˜ (ìµœì í™”, ê¸°ëŠ¥ ì´ìŠˆ ì•„ë‹˜)

### 3.3 [í†µê³„] null guestSessionId/userId ì²˜ë¦¬
- **íŒŒì¼**: `src/app/api/admin/stats/route.ts:309-338`
- **ë¬¸ì œ**: ë‘˜ ë‹¤ nullì¼ ë•Œ ë¹ˆ ë¬¸ìì—´ë¡œ ì²˜ë¦¬
- **í•´ê²°**: ëª…ì‹œì  null ì²´í¬ + ë¡œê¹… ì¶”ê°€ (nullIdentifierEvents ì¹´ìš´íŠ¸)
- **ìƒíƒœ**: âœ… ì™„ë£Œ

### 3.4 [í†µê³„] ê³µê°„ ì—†ì„ ë•Œ ì‘ë‹µ êµ¬ì¡° ë¶ˆì™„ì „
- **íŒŒì¼**: `src/app/api/admin/stats/route.ts:41-62`
- **ë¬¸ì œ**: ì¼ë¶€ í•„ë“œë§Œ ë°˜í™˜
- **í•´ê²°**: dataQuality í¬í•¨ ì „ì²´ í•„ë“œ ëª…ì‹œì  ë°˜í™˜
- **ìƒíƒœ**: âœ… ì™„ë£Œ

### 3.5 [ì±„íŒ…] íŒŒí‹° ì±„íŒ… DB ì €ì¥ ì—†ìŒ
- **íŒŒì¼**: `server/socket-server.ts:971-1036`
- **ë¬¸ì œ**: íŒŒí‹° ë©”ì‹œì§€ ì˜êµ¬ ê¸°ë¡ ë¶ˆê°€
- **í•´ê²°**: prisma.chatMessage.create + type: "PARTY", targetId: partyId
- **ìƒíƒœ**: âœ… ì™„ë£Œ

### 3.6 [ì±„íŒ…] ì•„ë°”íƒ€ ì •ë³´ ë³‘í•© ì‹œ nullish coalescing
- **íŒŒì¼**: `src/features/space/socket/useSocket.ts:390-405`
- **ë¬¸ì œ**: nullê³¼ undefined êµ¬ë¶„ ë¯¸í¡
- **í•´ê²°**: ê¸°ë³¸ê°’ "default" ì¶”ê°€ (avatarColor ?? existing?.avatarColor ?? "default")
- **ìƒíƒœ**: âœ… ì™„ë£Œ

### 3.7 [ì±„íŒ…] í”„ë¡œí•„ ì—…ë°ì´íŠ¸/ì´ë™ ê²½í•©
- **íŒŒì¼**: `server/socket-server.ts:994-1034`
- **ë¬¸ì œ**: ë™ì‹œ ì´ë²¤íŠ¸ ìˆœì„œ ë¯¸ë³´ì¥
- **í•´ê²°**: (í–¥í›„) ì´ë²¤íŠ¸ ì‹œí€€ìŠ¤ ë²ˆí˜¸ ì¶”ê°€ í•„ìš”
- **ìƒíƒœ**: â¸ï¸ ë³´ë¥˜ (ë³µì¡í•œ êµ¬í˜„, í˜„ì¬ í° ë¬¸ì œ ì•„ë‹˜)

### 3.8 [ì±„íŒ…] íŒŒí‹° ì±„íŒ… ê¶Œí•œ ê²€ì¦ ì—†ìŒ
- **íŒŒì¼**: `server/socket-server.ts:892-952`
- **ë¬¸ì œ**: ëˆ„êµ¬ë‚˜ íŒŒí‹° ì°¸ê°€ ê°€ëŠ¥
- **í•´ê²°**: (í–¥í›„) ì´ˆëŒ€ ê¸°ë°˜ íŒŒí‹° ì°¸ê°€ë¡œ ë³€ê²½ í•„ìš”
- **ìƒíƒœ**: â¸ï¸ ë³´ë¥˜ (íŒŒí‹° ê¸°ëŠ¥ í™•ì¥ ì‹œ êµ¬í˜„)

### 3.9 [ì±„íŒ…] ìŒì†Œê±° ìƒíƒœ ë©”ëª¨ë¦¬ë§Œ ì €ì¥
- **íŒŒì¼**: `server/socket-server.ts:1101-1167`
- **ë¬¸ì œ**: ì„œë²„ ì¬ì‹œì‘ ì‹œ ìŒì†Œê±° ì´ˆê¸°í™”
- **í•´ê²°**: (í–¥í›„) SpaceMember.restriction í•„ë“œ ì‚¬ìš© í•„ìš”
- **ìƒíƒœ**: â¸ï¸ ë³´ë¥˜ (ê´€ë¦¬ì ê¸°ëŠ¥ í™•ì¥ ì‹œ êµ¬í˜„)

### 3.10 [ì±„íŒ…] ì¬ì—°ê²° ì‹œ ì¤‘ë³µ ì…ì¥ ë¯¸ì²˜ë¦¬
- **íŒŒì¼**: `server/socket-server.ts:539-558`
- **ë¬¸ì œ**: ê¸°ì¡´ ì†Œì¼“ ê°•ì œ ì¢…ë£Œ ì—†ìŒ
- **í•´ê²°**: ê¸°ì¡´ ì†Œì¼“ disconnect í›„ ìƒˆ ì—°ê²° í—ˆìš© (ì—ëŸ¬ ë©”ì‹œì§€ ì „ì†¡)
- **ìƒíƒœ**: âœ… ì™„ë£Œ

### 3.11 [ì±„íŒ…] Rate Limitì´ socketIdë³„
- **íŒŒì¼**: `server/socket-server.ts:219-321`
- **ë¬¸ì œ**: ì—¬ëŸ¬ íƒ­ìœ¼ë¡œ Rate Limit ìš°íšŒ ê°€ëŠ¥
- **í•´ê²°**: playerId ê¸°ë°˜ Rate Limitìœ¼ë¡œ ë³€ê²½, ëª¨ë“  í˜¸ì¶œ ì—…ë°ì´íŠ¸
- **ìƒíƒœ**: âœ… ì™„ë£Œ

### 3.12 [ì¸ì¦] RBAC ì •ì±… ëª¨ìˆœ
- **íŒŒì¼**: `src/app/api/spaces/[id]/members/route.ts`, `staff/route.ts`
- **ë¬¸ì œ**: ì£¼ì„ê³¼ ì½”ë“œì˜ ê¶Œí•œ ì •ì±… ë¶ˆì¼ì¹˜
- **í•´ê²°**: (í˜„ì¬ ì½”ë“œ ë¶„ì„ ê²°ê³¼ ì£¼ì„ê³¼ ì½”ë“œ ì¼ì¹˜í•¨)
- **ìƒíƒœ**: â¸ï¸ ë³´ë¥˜ (ë¬¸ì œ ì—†ìŒ í™•ì¸)

### 3.13 [ì¸ì¦] ì´ì¤‘ ê²€ì¦ ë¡œì§ ë¶ˆì¼ì¹˜
- **íŒŒì¼**: `src/app/api/spaces/[id]/members/route.ts`
- **ë¬¸ì œ**: GET/DELETE vs POST/PATCH ê²€ì¦ ë¡œì§ ë‹¤ë¦„
- **í•´ê²°**: canManageMembers í•¨ìˆ˜ë¡œ í†µì¼ë˜ì–´ ìˆìŒ
- **ìƒíƒœ**: â¸ï¸ ë³´ë¥˜ (ë¬¸ì œ ì—†ìŒ í™•ì¸)

### 3.14 [ì¸ì¦] ìê¸° ìì‹  ê°•ë“±/ê°•í‡´ ê°€ëŠ¥
- **íŒŒì¼**: `src/app/api/spaces/[id]/members/route.ts:474-480, 638-645`
- **ë¬¸ì œ**: PATCH/DELETEì—ì„œ ìê¸° ìì‹  ì²´í¬ ì—†ìŒ
- **í•´ê²°**: PATCHì™€ DELETEì— ìê¸° ìì‹  ì²´í¬ ì¶”ê°€ (SuperAdmin ì˜ˆì™¸)
- **ìƒíƒœ**: âœ… ì™„ë£Œ

### 3.15 [ì¸ì¦] ì‚¬ìš©ì ì—´ê±° ê°€ëŠ¥
- **íŒŒì¼**: `src/app/api/spaces/[id]/staff/route.ts`
- **ë¬¸ì œ**: ì¡´ì¬í•˜ì§€ ì•ŠëŠ” userIdì— ëŒ€í•œ 404 ì‘ë‹µ
- **í•´ê²°**: (í–¥í›„) ì¼ê´€ëœ ì—ëŸ¬ ì‘ë‹µìœ¼ë¡œ ë³€ê²½ í•„ìš”
- **ìƒíƒœ**: â¸ï¸ ë³´ë¥˜ (ë‚®ì€ ìœ„í—˜ë„)

### 3.16 [ì¸ì¦] ê³µê°„ ìµœëŒ€ê°’ race condition
- **íŒŒì¼**: `src/app/api/guest/route.ts:107-144`
- **ë¬¸ì œ**: ë™ì‹œ ìš”ì²­ ì‹œ maxUsers ì´ˆê³¼ ê°€ëŠ¥
- **í•´ê²°**: prisma.$transactionìœ¼ë¡œ ì›ìì  ì²˜ë¦¬ (count + create íŠ¸ëœì­ì…˜)
- **ìƒíƒœ**: âœ… ì™„ë£Œ

### 3.17 [ì¸ì¦] ì—ëŸ¬ ì‘ë‹µ ì •ë³´ ëˆ„ìˆ˜
- **íŒŒì¼**: `src/app/api/guest/verify/route.ts:73-92`
- **ë¬¸ì œ**: ë‹¨ê³„ë³„ ì—ëŸ¬ë¡œ í† í° ìœ íš¨ì„± ì¶”ë¡  ê°€ëŠ¥
- **í•´ê²°**: ëª¨ë“  ê²€ì¦ ì‹¤íŒ¨ ì‹œ ë™ì¼í•œ "Invalid session" ë©”ì‹œì§€ ë°˜í™˜
- **ìƒíƒœ**: âœ… ì™„ë£Œ

---

## Phase 4: Low (ë¶„ê¸° ë‚´ ìˆ˜ì •) - âœ… ì™„ë£Œ (3/7)

### 4.1 [í†µê³„] authReturnRateData groupBy ì •ë ¬ ë¹„ìš©
- **íŒŒì¼**: `src/app/api/admin/stats/route.ts:210-218`
- **ë¬¸ì œ**: ëŒ€ê·œëª¨ ë°ì´í„°ì…‹ì—ì„œ ì„±ëŠ¥ ì €í•˜
- **í•´ê²°**: ì¸ë±ìŠ¤ ìµœì í™” ë˜ëŠ” ìºì‹± (DB ìŠ¤í‚¤ë§ˆ ë³€ê²½ í•„ìš”)
- **ìƒíƒœ**: â¸ï¸ ë³´ë¥˜ (ì¸í”„ë¼/ìŠ¤í‚¤ë§ˆ ë³€ê²½)

### 4.2 [í†µê³„] ìŠ¤í‚¤ë§ˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œ ì„¸ì…˜ ID ì¬ì‚¬ìš© ìœ„í—˜
- **íŒŒì¼**: `src/app/api/admin/stats/route.ts:264-272`
- **ë¬¸ì œ**: cuid() ì¬ì‚¬ìš© ê°€ëŠ¥ì„± (ì´ë¡ ì )
- **í•´ê²°**: cuid()ëŠ” ì´ë¯¸ ì¶©ë¶„íˆ ê³ ìœ í•¨ (ì•½ 10^36 ê²½ìš°ì˜ ìˆ˜)
- **ìƒíƒœ**: â¸ï¸ ë³´ë¥˜ (ì´ë¡ ì  ìœ„í—˜, ì‹¤ì œ ë¬¸ì œ ì—†ìŒ)

### 4.3 [ì±„íŒ…] ë¬´í•œ ì¬ì—°ê²° (ë°°í„°ë¦¬/ë¦¬ì†ŒìŠ¤ ë‚­ë¹„)
- **íŒŒì¼**: `src/features/space/socket/useSocket.ts:226-230`
- **ë¬¸ì œ**: `reconnectionAttempts: Infinity`
- **í•´ê²°**: 30íšŒë¡œ ì œí•œ (ì•½ 2.5ë¶„ê°„ ì‹œë„ í›„ ì¤‘ë‹¨)
- **ìƒíƒœ**: âœ… ì™„ë£Œ

### 4.4 [ì±„íŒ…] Presence API ì˜¤ë˜ëœ ë°ì´í„°
- **íŒŒì¼**: `server/socket-server.ts:335-385`
- **ë¬¸ì œ**: disconnect ì²˜ë¦¬ ì „ ìš”ì²­ ì‹œ stale ë°ì´í„°
- **í•´ê²°**: TTL ë˜ëŠ” ì •ë¦¬ ë©”ì»¤ë‹ˆì¦˜ (ì¸í”„ë¼ ë³€ê²½ í•„ìš”)
- **ìƒíƒœ**: â¸ï¸ ë³´ë¥˜ (ì¸í”„ë¼ ë³€ê²½)

### 4.5 [ì±„íŒ…] ì¤‘ë³µ ë©”ì‹œì§€ ì²´í¬ trim ë¶ˆì¼ì¹˜
- **íŒŒì¼**: `server/socket-server.ts:243-264`
- **ë¬¸ì œ**: ê¸¸ì´ ì²´í¬ì™€ ì¤‘ë³µ ì²´í¬ì˜ trim ì ìš© ì‹œì  ë‹¤ë¦„
- **í•´ê²°**: trim ë¨¼ì € ì ìš© + ë¹ˆ ë©”ì‹œì§€ ì²´í¬ ì¶”ê°€
- **ìƒíƒœ**: âœ… ì™„ë£Œ

### 4.6 [ì±„íŒ…] í•´ì‹œ ì¶©ëŒ ê°€ëŠ¥ì„±
- **íŒŒì¼**: `server/socket-server.ts:224-231`
- **ë¬¸ì œ**: 32bit í•´ì‹œë¡œ ì¶©ëŒ ê°€ëŠ¥
- **í•´ê²°**: SHA256 í•´ì‹œ (16ì hex, ì¶©ëŒ ê°€ëŠ¥ì„± ì œê±°)
- **ìƒíƒœ**: âœ… ì™„ë£Œ

### 4.7 [ì¸ì¦] ê²ŒìŠ¤íŠ¸ ì„¸ì…˜ ë§Œë£Œ ì²˜ë¦¬ ëŠìŠ¨
- **íŒŒì¼**: `src/app/api/guest/verify/route.ts:90`
- **ë¬¸ì œ**: ê²½ê³„ê°’ ì²˜ë¦¬ ë° ì •ë¦¬ ë©”ì»¤ë‹ˆì¦˜ ë¶€ì¬
- **í•´ê²°**: cron job ë˜ëŠ” ì •ë¦¬ ìŠ¤ì¼€ì¤„ëŸ¬ í•„ìš”
- **ìƒíƒœ**: â¸ï¸ ë³´ë¥˜ (ì¸í”„ë¼/ìŠ¤ì¼€ì¤„ëŸ¬ ì¶”ê°€ í•„ìš”)

---

## ìˆ˜ì • íŒŒì¼ ëª©ë¡ (ì˜ˆìƒ)

### Phase 1 (3ê°œ íŒŒì¼)
- `src/app/api/admin/stats/route.ts`
- `src/app/api/dashboard/spaces/[id]/stats/route.ts`
- `src/app/api/spaces/[id]/members/route.ts`

### Phase 2 (4ê°œ íŒŒì¼)
- `server/socket-server.ts`
- `src/features/space/socket/useSocket.ts`
- `src/app/api/guest/route.ts`
- `src/app/api/livekit/token/route.ts`

### Phase 3 (4ê°œ íŒŒì¼)
- `src/lib/space-auth.ts`
- `src/app/api/spaces/[id]/staff/route.ts`
- `src/app/api/guest/verify/route.ts`
- `server/socket-server.ts`

### Phase 4 (3ê°œ íŒŒì¼)
- `src/app/api/admin/stats/route.ts`
- `src/features/space/socket/useSocket.ts`
- `server/socket-server.ts`

---

## ë³€ê²½ ì´ë ¥

| ë‚ ì§œ | ë³€ê²½ ë‚´ìš© |
|-----|----------|
| 2026-01-07 | TASK.md ì´ˆê¸° ìƒì„± - 38ê°œ í—ˆì  ìˆ˜ì • í•­ëª© ì •ì˜ |
| 2026-01-07 | Phase 1-4 ì™„ë£Œ - 27/38 ìˆ˜ì •, 11ê°œ ë³´ë¥˜ (ìµœì í™”/ì¸í”„ë¼ ê´€ë ¨) |

---

## ê²€ì¦ ëª…ë ¹ì–´

```bash
# íƒ€ì…ì²´í¬
npx tsc --noEmit

# ë¹Œë“œí…ŒìŠ¤íŠ¸
npm run build

# Socket ì„œë²„ í…ŒìŠ¤íŠ¸
npm run socket:dev

# ì „ì²´ ê°œë°œ ì„œë²„
npm run dev:all
```
