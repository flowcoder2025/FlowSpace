# TASK: ì±„íŒ… ì‹œìŠ¤í…œ ìµœì í™”

> **ëª©í‘œ**: ë¸Œë¼ìš°ì € ì„±ëŠ¥, ìš´ì˜ ì•ˆì •ì„±, UX ê°œì„ ì„ ìœ„í•œ ì±„íŒ… ì‹œìŠ¤í…œ ìµœì í™”
> **ì£¼ì˜**: ê¸°ì¡´ ê¸°ëŠ¥(ê·“ì†ë§, íŒŒí‹°, ë‹µì¥, ì‚­ì œ, ìŒì†Œê±° ë“±) ë™ì‘ì— ì˜í–¥ ì—†ì–´ì•¼ í•¨
> **ì‹œì‘ì¼**: 2025-12-18

---

## Phase 1: Rate Limiting (ì„œë²„ ë³´ì•ˆ) âœ… ì™„ë£Œ

**ëª©í‘œ**: ë„ë°° ê³µê²© ë°©ì§€, ìš´ì˜ ì•ˆì •ì„± í™•ë³´

- [x] ìœ ì €ë‹¹ ë©”ì‹œì§€ ë¹ˆë„ ì œí•œ (5msg/5ì´ˆ, ë²„ìŠ¤íŠ¸ í—ˆìš©)
- [x] ë™ì¼ ë©”ì‹œì§€ ë°˜ë³µ ì°¨ë‹¨ (ì—°ì† 3íšŒ)
- [x] ë©”ì‹œì§€ ê¸¸ì´ ì œí•œ (2000ì)
- [x] ì—ëŸ¬ ë©”ì‹œì§€ í´ë¼ì´ì–¸íŠ¸ ì „ë‹¬

**íŒŒì¼**: `server/socket-server.ts` (line 198-300)

---

## Phase 2: í´ë¼ì´ì–¸íŠ¸ ë©”ëª¨ë¦¬ ìƒí•œ âœ… ì™„ë£Œ

**ëª©í‘œ**: ì¥ì‹œê°„ ì„¸ì…˜ì—ì„œ ë¸Œë¼ìš°ì € ì•ˆì •ì„± í™•ë³´

- [x] ë©”ì‹œì§€ ë°°ì—´ ìµœëŒ€ 500ê°œ ì œí•œ
- [x] ìƒˆ ë©”ì‹œì§€ ì¶”ê°€ ì‹œ ì˜¤ë˜ëœ ë©”ì‹œì§€ ì œê±°
- [x] íƒ­ë³„ ë©”ì‹œì§€ ì¹´ìš´íŠ¸ì— ì˜í–¥ ì—†ë„ë¡ ì²˜ë¦¬

**íŒŒì¼**: `src/features/space/components/SpaceLayout.tsx` (line 66-89, addMessagesWithLimit í•¨ìˆ˜)

---

## Phase 3: ë Œë” ìµœì í™” âœ… ì™„ë£Œ

**ëª©í‘œ**: ì±„íŒ… ë¦¬ë Œë” ìµœì†Œí™”ë¡œ UX ê°œì„ 

- [x] ChatMessageItem ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬ + React.memo ì ìš©
- [x] key ì•ˆì •ì„± í™•ì¸ (msg.id ì‚¬ìš©)
- [x] ì½œë°± í•¨ìˆ˜ useCallback ì ìš© (ì´ë¯¸ ì ìš©ë˜ì–´ ìˆìŒ í™•ì¸)

**íŒŒì¼**: `src/features/space/components/chat/ChatMessageList.tsx` (line 325-470)

---

## Phase 4: ê³¼ê±° ë©”ì‹œì§€ Pagination âœ… ì™„ë£Œ

**ëª©í‘œ**: ìŠ¤í¬ë¡¤ ìƒë‹¨ ë„ë‹¬ ì‹œ ì´ì „ ë©”ì‹œì§€ ë¡œë”©

### 4.1 API ìƒì„± âœ… ì™„ë£Œ
- [x] GET /api/spaces/[id]/messages API ìƒì„±
- [x] cursor ê¸°ë°˜ í˜ì´ì§€ë„¤ì´ì…˜ (message ID ì‚¬ìš©)
- [x] ë©¤ë²„ì‹­/ê²ŒìŠ¤íŠ¸ ì¸ì¦ ì²˜ë¦¬
- [x] ê·“ì†ë§ í•„í„°ë§ (ë³¸ì¸ ê´€ë ¨ë§Œ ì¡°íšŒ)

**íŒŒì¼**: `src/app/api/spaces/[id]/messages/route.ts`

### 4.2 usePastMessages í›… âœ… ì™„ë£Œ
- [x] í›… ìƒì„± ë° export
- [x] cursor ê´€ë¦¬ (cursorRef)
- [x] ì¤‘ë³µ ì œê±° (loadedIdsRef)
- [x] mergePastMessages ìœ í‹¸ë¦¬í‹°

**íŒŒì¼**: `src/features/space/hooks/usePastMessages.ts`

### 4.3 ìŠ¤í¬ë¡¤ ê°ì§€ âœ… ì™„ë£Œ
- [x] ChatMessageListì— pagination props ì¶”ê°€
- [x] IntersectionObserver êµ¬í˜„
- [x] ë¡œë”© ìŠ¤í”¼ë„ˆ UI

**íŒŒì¼**: `src/features/space/components/chat/ChatMessageList.tsx`

### 4.4 í†µí•© âœ… ì™„ë£Œ
- [x] FloatingChatOverlayì— pagination props ì¶”ê°€
- [x] SpaceLayoutì—ì„œ usePastMessages ì´ˆê¸°í™”
- [x] handleLoadMore ì½œë°± ì—°ê²°
- [x] ë¹Œë“œ í…ŒìŠ¤íŠ¸ í†µê³¼

**íŒŒì¼**: `FloatingChatOverlay.tsx`, `SpaceLayout.tsx`

---

## ê¸°ì¡´ ê¸°ëŠ¥ ì²´í¬ë¦¬ìŠ¤íŠ¸ (íšŒê·€ ë°©ì§€)

| ê¸°ëŠ¥ | ìƒíƒœ | í…ŒìŠ¤íŠ¸ í•­ëª© | í…ŒìŠ¤íŠ¸ ê²°ê³¼ |
|-----|------|-----------|------------|
| ì¼ë°˜ ì±„íŒ… | âœ… | ë©”ì‹œì§€ ì „ì†¡/ìˆ˜ì‹  | ì •ìƒ ë™ì‘ |
| ê·“ì†ë§ | â³ | 1:1 ë¹„ë°€ ëŒ€í™” | ë‹¨ë… í…ŒìŠ¤íŠ¸ ë¶ˆê°€ (2ì¸ í•„ìš”) |
| íŒŒí‹° ì±„íŒ… | â³ | êµ¬ì—­ ë‚´ ì±„íŒ… | ë‹¨ë… í…ŒìŠ¤íŠ¸ ë¶ˆê°€ (íŒŒí‹° í•„ìš”) |
| ë‹µì¥ | âœ… | replyTo í‘œì‹œ | ì›ë³¸ ì¸ìš© + ë‹µì¥ ì •ìƒ |
| ì‹œìŠ¤í…œ ë©”ì‹œì§€ | âœ… | ì…ì¥/í‡´ì¥ ì•Œë¦¼ | ì…ì¥ ì•Œë¦¼ ì •ìƒ |
| ê³µì§€ì‚¬í•­ | â³ | ê´€ë¦¬ì ê³µì§€ | ë¯¸í…ŒìŠ¤íŠ¸ |
| ë©”ì‹œì§€ ì‚­ì œ | â³ | ê´€ë¦¬ì ì‚­ì œ | ë¯¸í…ŒìŠ¤íŠ¸ |
| ìŒì†Œê±° | â³ | ì±„íŒ… ì°¨ë‹¨ | ë¯¸í…ŒìŠ¤íŠ¸ |
| ë¦¬ì•¡ì…˜ | âœ… | ğŸ‘â¤ï¸âœ… ë°˜ì‘ | ì •ìƒ ë™ì‘, ì¹´ìš´íŠ¸ í‘œì‹œ |

### ë²„ê·¸ ìˆ˜ì • (2025-12-19)

- [x] **usePastMessages ë¬´í•œ ë£¨í”„ ë²„ê·¸**: ê³µê°„ì´ DBì— ì—†ì„ ë•Œ API 404 ì—ëŸ¬ ì‹œ `hasMore`ê°€ `true`ë¡œ ìœ ì§€ë˜ì–´ IntersectionObserverê°€ ë¬´í•œ í˜¸ì¶œë˜ëŠ” ë¬¸ì œ ìˆ˜ì •
  - **ìˆ˜ì • ë‚´ìš©**: catch ë¸”ë¡ì—ì„œ `setHasMore(false)` ì¶”ê°€
  - **íŒŒì¼**: `src/features/space/hooks/usePastMessages.ts` (line 156)

---

## ì§„í–‰ ìƒíƒœ

| Phase | ìƒíƒœ | ì‹œì‘ì¼ | ì™„ë£Œì¼ |
|-------|------|-------|-------|
| Phase 1 | âœ… ì™„ë£Œ | 2025-12-18 | 2025-12-18 |
| Phase 2 | âœ… ì™„ë£Œ | 2025-12-18 | 2025-12-18 |
| Phase 3 | âœ… ì™„ë£Œ | 2025-12-18 | 2025-12-18 |
| Phase 4 | âœ… ì™„ë£Œ | 2025-12-18 | 2025-12-18 |

